<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width,initial-scale=1.0" />

  <title>ZOTHEOS OS | Offline Ethical Intelligence</title>

  <link rel="icon" type="image/x-icon" href="/static/favicon_blackBW.ico" />

 

  <style>

    @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;600&display=swap');

 

    :root{

      --bg-dark:#050505;

      --text-main:#f5f5f5;

      --text-dim:#a0a0a0;

      --text-soft:#c9c9c9;

 

      --accent:#ffffff;

 

      --glass-panel:rgba(10,10,10,0.84);

      --glass-panel-2:rgba(12,12,12,0.72);

      --border:rgba(255,255,255,0.08);

      --border-strong:rgba(255,255,255,0.14);

 

      --tier-1:#ffffff;

      --tier-2:#ff3b3b;

      --tier-3:#8a8a8a;

 

      --ok:#ffffff;

      --warn:#9b9b9b;

      --bad:#ff3b3b;

 

      --shadow: 0 24px 60px rgba(0,0,0,0.65);

      --shadow-soft: 0 10px 30px rgba(0,0,0,0.45);

 

      --radius: 12px;

      --mono: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

      --sans: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;

      --display: 'Bebas Neue', system-ui, sans-serif;

 

      --focus: 0 0 0 3px rgba(255,255,255,0.12);

 

      --ease: cubic-bezier(0.16, 1, 0.3, 1);

      --dur: 220ms;

      --grid-gap: 18px;

 

      /* Mobile tuning vars */

      --tap: 44px;

    }

 

    * { box-sizing: border-box; }

    html, body { height: 100%; }

 

    body{

      background-color:var(--bg-dark);

      color:var(--text-main);

      font-family:var(--sans);

      margin:0;

      padding:0;

      overflow-x:hidden;

    }

 

    /* ====== BACKGROUND CANVAS ====== */

    #bgCanvas{

      position: fixed;

      inset: 0;

      width: 100%;

      height: 100%;

      z-index: 0;

      pointer-events: none;

      filter: blur(0.2px) saturate(1.05) contrast(1.05);

      opacity: 1;

    }

 

    /* Noise overlay */

    body::before {

      content: "";

      position: fixed; inset: 0;

      background-image:

        url("data:image/svg+xml,%3Csvg xmlns='https://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");

      opacity: 0.055;

      pointer-events: none;

      z-index: 1;

    }

 

    /* Vignette */

    body::after{

      content:"";

      position: fixed; inset: 0;

      background:

        radial-gradient(70% 55% at 50% 30%, rgba(0,0,0,0.10) 10%, rgba(0,0,0,0.55) 70%, rgba(0,0,0,0.75) 100%),

        radial-gradient(1200px 600px at 50% 15%, rgba(255,255,255,0.05), transparent 60%);

      pointer-events: none;

      z-index: 2;

    }

 

    .container{

      position: relative;

      z-index:10;

      width:100%;

      max-width:1180px;

      padding:34px 18px 60px;

      margin:0 auto;

    }

 

    header{

      text-align:center;

      margin-bottom:14px;

    }

 

    .logo{

      height:88px;

      margin-bottom:8px;

      filter: drop-shadow(0 0 16px rgba(255,255,255,0.10));

      user-select: none;

    }

 

    .subtitle{

      font-size:0.78rem;

      color:var(--text-dim);

      letter-spacing:5px;

      text-transform:uppercase;

      font-weight:300;

    }

 

    .promise{

      margin-top: 10px;

      font-size: 0.95rem;

      color: rgba(255,255,255,0.88);

      line-height: 1.45;

    }

 

    /* ====== STATUS STRIP ====== */

    .status-strip{

      margin: 18px 0 14px;

      padding: 12px;

      border: 1px solid var(--border);

      background: rgba(0,0,0,0.35);

      backdrop-filter: blur(18px);

      border-radius: var(--radius);

      box-shadow: var(--shadow-soft);

      display:flex;

      align-items:center;

      justify-content: space-between;

      gap: 10px;

      flex-wrap: wrap;

    }

 

    .os-meta{

      display:flex;

      align-items:center;

      gap: 10px;

      flex-wrap: wrap;

      font-family: var(--mono);

      font-size: 0.70rem;

      color: var(--text-dim);

      text-transform: uppercase;

      letter-spacing: 0.7px;

    }

 

    .pill{

      display:inline-flex;

      align-items:center;

      gap:8px;

      padding: 7px 10px;

      border: 1px solid var(--border);

      border-radius: 999px;

      background: rgba(0,0,0,0.32);

    }

 

    .dot{

      width: 8px; height: 8px;

      border-radius: 50%;

      background: var(--tier-3);

      box-shadow: 0 0 0 3px rgba(255,255,255,0.06);

    }

    .dot.ok{ background: var(--ok); }

    .dot.warn{ background: var(--warn); }

    .dot.bad{ background: var(--bad); }

 

    .status-actions{

      display:flex;

      align-items:center;

      gap: 10px;

      flex-wrap: wrap;

    }

 

    .mode-switch{

      display:flex;

      justify-content:center;

      gap:12px;

      margin: 10px 0 18px;

      flex-wrap: wrap;

    }

 

    .mode-btn{

      background: rgba(0,0,0,0.52);

      border: 1px solid var(--border);

      color: var(--text-dim);

      padding: 12px 26px;

      cursor: pointer;

      font-family: var(--display);

      letter-spacing: 2px;

      font-size: 1.05rem;

      border-radius: 10px;

      transition: transform var(--dur) var(--ease), border-color var(--dur) var(--ease), background var(--dur) var(--ease), color var(--dur) var(--ease), box-shadow var(--dur) var(--ease);

      backdrop-filter: blur(12px);

      user-select:none;

    }

 

    .mode-btn:hover{

      transform: translateY(-1px);

      border-color: var(--border-strong);

      color: var(--text-main);

      box-shadow: 0 0 0 3px rgba(255,255,255,0.04);

    }

 

    .mode-btn.active{

      border-color: rgba(255,255,255,0.35);

      color: var(--accent);

      background: rgba(255,255,255,0.06);

      box-shadow: 0 0 24px rgba(255,255,255,0.06);

    }

 

    .panel{ display:none; animation: fadeIn 260ms var(--ease); }

    .panel.active{ display:block; }

    @keyframes fadeIn { from{opacity:0; transform: translateY(6px);} to{opacity:1; transform: translateY(0);} }

 

    .card{

      background: var(--glass-panel);

      border: 1px solid var(--border);

      border-radius: var(--radius);

      padding: 22px;

      margin-bottom: 18px;

      backdrop-filter: blur(22px);

      box-shadow: var(--shadow);

    }

    .card.slim{ padding: 16px; background: var(--glass-panel-2); }

 

    .card h2{

      font-family: var(--display);

      font-size: 1.55rem;

      letter-spacing: 2px;

      margin: 0 0 14px;

      text-transform: uppercase;

      border-bottom: 1px solid var(--border);

      padding-bottom: 10px;

    }

 

    .muted{ color: var(--text-dim); }

 

    /* Guided input */

    .input-box{

      background: rgba(12,12,12,0.78);

      border: 1px solid var(--border);

      border-radius: var(--radius);

      padding: 18px;

      margin-bottom: 18px;

      box-shadow: var(--shadow-soft);

      backdrop-filter: blur(18px);

    }

 

    .guide-row{

      display:flex;

      align-items:center;

      justify-content: space-between;

      gap: 12px;

      flex-wrap: wrap;

      margin-bottom: 10px;

    }

 

    .guide-left{

      display:flex;

      flex-direction: column;

      gap: 6px;

      min-width: 240px;

      flex: 1 1 auto;

    }

 

    .guide-title{

      font-family: var(--mono);

      font-size: 0.75rem;

      color: rgba(255,255,255,0.82);

      letter-spacing: 0.6px;

      text-transform: uppercase;

    }

 

    .guide-sub{

      font-size: 0.92rem;

      color: var(--text-dim);

      line-height: 1.35;

    }

 

    .chips{

      display:flex;

      gap: 8px;

      flex-wrap: wrap;

      justify-content:flex-end;

    }

 

    .chip-btn{

      background: rgba(0,0,0,0.35);

      border: 1px solid var(--border);

      color: rgba(255,255,255,0.86);

      border-radius: 999px;

      padding: 8px 10px;

      cursor: pointer;

      font-family: var(--mono);

      font-size: 0.72rem;

      transition: transform var(--dur) var(--ease), border-color var(--dur) var(--ease), background var(--dur) var(--ease);

      user-select:none;

      white-space: nowrap;

      min-height: 34px;

    }

    .chip-btn:hover{

      transform: translateY(-1px);

      border-color: rgba(255,255,255,0.20);

      background: rgba(255,255,255,0.04);

    }

 

    textarea{

      width:100%;

      background: rgba(0,0,0,0.18);

      border: 1px solid var(--border);

      border-radius: 12px;

      color: var(--text-main);

      font-family: var(--sans);

      font-size: 1.05rem;

      min-height: 120px;

      outline: none;

      line-height: 1.55;

      padding: 14px 14px;

      transition: border-color var(--dur) var(--ease), box-shadow var(--dur) var(--ease);

      resize: vertical;

    }

    textarea:focus{

      border-color: rgba(255,255,255,0.22);

      box-shadow: var(--focus);

    }

 

    .toolbar{

      display:flex;

      justify-content: space-between;

      align-items:center;

      gap: 12px;

      flex-wrap: wrap;

      margin-top: 10px;

      border-top: 1px solid var(--border);

      padding-top: 14px;

    }

 

    .toolbar-left, .toolbar-right{

      display:flex;

      align-items:center;

      gap: 10px;

      flex-wrap: wrap;

    }

 

    .kbd{

      font-family: var(--mono);

      font-size: 0.72rem;

      border: 1px solid var(--border);

      padding: 4px 7px;

      border-radius: 8px;

      color: var(--text-dim);

      background: rgba(0,0,0,0.25);

    }

 

    .btn-primary{

      background: var(--accent);

      color: #000;

      border: none;

      padding: 12px 22px;

      border-radius: 12px;

      font-family: var(--display);

      font-size: 1.12rem;

      letter-spacing: 1.4px;

      cursor: pointer;

      transition: transform var(--dur) var(--ease), box-shadow var(--dur) var(--ease), background var(--dur) var(--ease);

      user-select:none;

      min-height: var(--tap);

    }

    .btn-primary:hover{

      background: #ffffff;

      transform: translateY(-1px);

      box-shadow: 0 0 0 3px rgba(255,255,255,0.12), 0 18px 45px rgba(0,0,0,0.35);

    }

    .btn-primary:active{ transform: translateY(0px) scale(0.99); }

 

    .btn-quiet{

      background: transparent;

      color: var(--text-dim);

      border: 1px solid var(--border);

      padding: 10px 14px;

      border-radius: 12px;

      cursor: pointer;

      font-size: 0.72rem;

      text-transform: uppercase;

      letter-spacing: 1px;

      transition: transform var(--dur) var(--ease), border-color var(--dur) var(--ease), color var(--dur) var(--ease), background var(--dur) var(--ease);

      user-select:none;

      font-family: var(--mono);

      min-height: var(--tap);

    }

    .btn-quiet:hover{

      border-color: rgba(255,255,255,0.22);

      color: var(--text-main);

      transform: translateY(-1px);

      background: rgba(255,255,255,0.03);

    }

    .btn-danger{

      border-color: rgba(255,59,59,0.45) !important;

      color: var(--bad) !important;

    }

    .btn-danger:hover{

      border-color: rgba(255,59,59,0.65) !important;

      background: rgba(255,59,59,0.08) !important;

    }

 

    .toggle{

      display:inline-flex;

      align-items:center;

      gap: 10px;

      padding: 9px 12px;

      border-radius: 12px;

      border: 1px solid var(--border);

      background: rgba(0,0,0,0.25);

      user-select:none;

      cursor: pointer;

      transition: border-color var(--dur) var(--ease), transform var(--dur) var(--ease);

      font-family: var(--mono);

      font-size: 0.72rem;

      text-transform: uppercase;

      letter-spacing: 0.8px;

      color: var(--text-dim);

      min-height: var(--tap);

    }

    .toggle:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,0.18); }

    .toggle .switch{

      width: 42px;

      height: 22px;

      border-radius: 999px;

      border: 1px solid var(--border);

      background: rgba(255,255,255,0.06);

      position: relative;

      transition: background var(--dur) var(--ease), border-color var(--dur) var(--ease);

      flex: 0 0 auto;

    }

    .toggle .switch::after{

      content:"";

      position:absolute;

      top: 2px; left: 2px;

      width: 18px; height: 18px;

      border-radius: 50%;

      background: rgba(255,255,255,0.85);

      transition: transform var(--dur) var(--ease), background var(--dur) var(--ease);

    }

    .toggle.on{

      color: var(--text-main);

      border-color: rgba(255,59,59,0.35);

    }

    .toggle.on .switch{

      background: rgba(255,59,59,0.12);

      border-color: rgba(255,59,59,0.35);

    }

    .toggle.on .switch::after{

      transform: translateX(20px);

      background: var(--bad);

    }

 

    /* Tooltip */

    .tip{

      display:inline-flex;

      align-items:center;

      gap: 8px;

      font-family: var(--mono);

      font-size: 0.72rem;

      color: var(--text-dim);

      user-select:none;

    }

    .tip button{

      border: 1px solid var(--border);

      background: rgba(0,0,0,0.25);

      color: rgba(255,255,255,0.82);

      border-radius: 999px;

      width: 22px;

      height: 22px;

      cursor: pointer;

      font-family: var(--mono);

      font-size: 0.75rem;

      line-height: 1;

      transition: border-color var(--dur) var(--ease), transform var(--dur) var(--ease);

    }

    .tip button:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,0.20); }

 

    /* Collapsible sections */

    details.section{

      border: 1px solid var(--border);

      border-radius: 14px;

      background: rgba(255,255,255,0.02);

      padding: 12px 14px;

      margin-top: 12px;

    }

    details.section summary{

      cursor:pointer;

      font-family: var(--mono);

      font-size: 0.75rem;

      color: rgba(255,255,255,0.80);

      letter-spacing: 0.6px;

      text-transform: uppercase;

      user-select:none;

    }

 

    .loader{

      display:none;

      text-align:center;

      font-family: var(--display);

      font-size: 1.6rem;

      letter-spacing: 4px;

      margin: 22px 0;

      color: var(--accent);

      animation: pulse 1.25s infinite;

      user-select:none;

    }

    @keyframes pulse { 0% { opacity: 0.35; } 50% { opacity: 1; } 100% { opacity: 0.35; } }

 

    #output{ display:none; margin-top: 16px; }

 

    .synthesis{

      line-height: 1.75;

      color: #eee;

      font-size: 1.03rem;

      white-space: pre-wrap;

      word-break: break-word;

    }

 

    .runtime{

      font-family: var(--mono);

      font-size: 0.68rem;

      color: var(--text-dim);

      margin-top: 18px;

      text-align: right;

    }

 

    .row{

      display:flex;

      gap: var(--grid-gap);

      flex-wrap: wrap;

      align-items: center;

      justify-content: space-between;

    }

 

    .mini{

      font-family: var(--mono);

      font-size: 0.72rem;

      color: var(--text-dim);

    }

 

    .alert{

      display:none;

      background: rgba(255,59,59,0.10);

      border: 1px solid rgba(255,59,59,0.40);

      color: var(--bad);

      padding: 14px;

      border-radius: 12px;

      margin-bottom: 14px;

      font-size: 0.88rem;

      line-height: 1.4;

    }

 

    .arb-summary{

      font-size: 0.96rem;

      color: #cfcfcf;

      line-height: 1.65;

      white-space: pre-wrap;

    }

 

    .vault-item{

      padding: 14px 0;

      border-bottom: 1px solid var(--border);

    }

 

    .vault-head{

      display:flex;

      align-items:center;

      justify-content: space-between;

      gap: 12px;

      flex-wrap: wrap;

      margin-bottom: 10px;

      font-family: var(--mono);

      font-size: 0.72rem;

      color: var(--text-dim);

    }

 

    .tier-badge{

      display:inline-flex;

      align-items:center;

      gap: 8px;

      padding: 4px 10px;

      border-radius: 999px;

      font-weight: 700;

      color: #000;

      letter-spacing: 0.6px;

      border: 1px solid rgba(0,0,0,0.25);

      text-transform: uppercase;

      box-shadow: 0 10px 25px rgba(0,0,0,0.20);

      user-select:none;

    }

    .tier-1{ background: var(--tier-1); }

    .tier-2{ background: var(--tier-2); }

    .tier-3{ background: var(--tier-3); color:#111; }

 

    .vault-body{

      font-size: 0.90rem;

      color: #d0d0d0;

      line-height: 1.6;

      white-space: pre-wrap;

      word-break: break-word;

    }

 

    .vault-meta{

      display:flex;

      gap: 10px;

      flex-wrap: wrap;

      align-items:center;

      justify-content:flex-end;

    }

 

    .chip{

      display:inline-flex;

      align-items:center;

      gap: 6px;

      padding: 6px 10px;

      border-radius: 999px;

      border: 1px solid var(--border);

      background: rgba(0,0,0,0.25);

      color: var(--text-dim);

      font-family: var(--mono);

      font-size: 0.70rem;

      user-select:none;

    }

 

    .bias-grid{

      display:grid;

      grid-template-columns: 1.2fr 0.8fr;

      gap: 26px;

    }

    .bias-bar-outer{

      width:100%;

      height: 8px;

      background: rgba(255,255,255,0.06);

      border-radius: 999px;

      margin-top: 10px;

      overflow:hidden;

      border: 1px solid rgba(255,255,255,0.04);

    }

    .bias-bar-inner{

      height:100%;

      width:0%;

      background: var(--accent);

      transition: width 800ms var(--ease);

      border-radius: 999px;

    }

    .diag-stat{

      display:flex;

      align-items:center;

      justify-content: space-between;

      gap: 10px;

      margin-top: 12px;

      font-family: var(--mono);

      font-size: 0.72rem;

      color: var(--text-dim);

    }

    .leaning{

      font-family: var(--display);

      font-size: 1.9rem;

      letter-spacing: 4px;

      margin: 0 0 10px;

      color: var(--accent);

      user-select:none;

    }

 

    .perspectives-grid{

      display:grid;

      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));

      gap: 16px;

    }

    .persp-card{

      background: rgba(255,255,255,0.03);

      padding: 18px;

      border-radius: 14px;

      border: 1px solid var(--border);

      box-shadow: 0 10px 30px rgba(0,0,0,0.25);

      transition: transform var(--dur) var(--ease), border-color var(--dur) var(--ease);

    }

    .persp-card:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,0.16); }

    .persp-label{

      color: var(--text-dim);

      font-size: 0.70rem;

      font-family: var(--mono);

      letter-spacing: 0.8px;

      text-transform: uppercase;

    }

    .persp-text{

      font-size: 0.92rem;

      margin-top: 12px;

      color: #c7c7c7;

      line-height: 1.55;

      white-space: pre-wrap;

      word-break: break-word;

    }

 

    .hintbar{

      margin-top: 14px;

      color: var(--text-dim);

      font-family: var(--mono);

      font-size: 0.72rem;

      display:flex;

      gap: 10px;

      flex-wrap: wrap;

      justify-content: center;

      opacity: 0.9;

    }

 

    .toasts{

      position: fixed;

      bottom: 16px;

      right: 16px;

      z-index: 50;

      display:flex;

      flex-direction: column;

      gap: 10px;

      max-width: 360px;

    }

    .toast{

      border: 1px solid var(--border);

      background: rgba(0,0,0,0.55);

      backdrop-filter: blur(18px);

      border-radius: 14px;

      padding: 12px 12px;

      box-shadow: var(--shadow-soft);

      display:flex;

      gap: 10px;

      align-items:flex-start;

      animation: toastIn 260ms var(--ease);

    }

    @keyframes toastIn{ from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    .toast .ticon{ width: 10px; height: 10px; margin-top: 6px; border-radius: 50%; background: var(--tier-3); flex: 0 0 auto; }

    .toast.ok .ticon{ background: var(--ok); }

    .toast.warn .ticon{ background: var(--warn); }

    .toast.bad .ticon{ background: var(--bad); }

    .toast .tmain{ flex: 1 1 auto; min-width: 0; }

    .toast .ttitle{

      font-family: var(--mono);

      font-size: 0.72rem;

      color: var(--text-main);

      letter-spacing: 0.4px;

      text-transform: uppercase;

      margin: 0 0 4px;

    }

    .toast .tmsg{

      font-size: 0.86rem;

      color: var(--text-soft);

      line-height: 1.35;

      margin: 0;

      word-break: break-word;

    }

    .toast .tclose{

      background: transparent;

      border: 1px solid var(--border);

      color: var(--text-dim);

      border-radius: 10px;

      font-family: var(--mono);

      font-size: 0.72rem;

      padding: 4px 8px;

      cursor:pointer;

      flex: 0 0 auto;

      transition: border-color var(--dur) var(--ease), color var(--dur) var(--ease);

      min-height: 32px;

    }

    .toast .tclose:hover{ border-color: rgba(255,255,255,0.22); color: var(--text-main); }

 

    /* ====== MODEL CARD MODAL ====== */

    .modal-backdrop{

      position: fixed;

      inset: 0;

      background: rgba(0,0,0,0.65);

      backdrop-filter: blur(8px);

      z-index: 80;

      display:none;

      align-items: center;

      justify-content: center;

      padding: 16px;

    }

    .modal{

      width: 100%;

      max-width: 780px;

      border: 1px solid var(--border-strong);

      border-radius: 16px;

      background: rgba(8,8,8,0.78);

      box-shadow: var(--shadow);

      padding: 16px;

    }

    .modal-head{

      display:flex;

      align-items:flex-start;

      justify-content: space-between;

      gap: 12px;

      border-bottom: 1px solid var(--border);

      padding-bottom: 12px;

      margin-bottom: 12px;

    }

    .modal-title{

      font-family: var(--display);

      letter-spacing: 2px;

      font-size: 1.6rem;

      margin: 0;

      text-transform: uppercase;

    }

    .modal-sub{

      margin: 6px 0 0;

      color: var(--text-dim);

      font-family: var(--mono);

      font-size: 0.74rem;

      text-transform: uppercase;

      letter-spacing: 0.7px;

    }

    .modal-grid{

      display:grid;

      grid-template-columns: 1fr 1fr;

      gap: 14px;

    }

    .kv{

      border: 1px solid var(--border);

      border-radius: 14px;

      padding: 12px;

      background: rgba(255,255,255,0.02);

    }

    .kv .k{

      font-family: var(--mono);

      font-size: 0.70rem;

      text-transform: uppercase;

      letter-spacing: 0.7px;

      color: var(--text-dim);

    }

    .kv .v{

      margin-top: 8px;

      color: rgba(255,255,255,0.92);

      line-height: 1.45;

      font-size: 0.95rem;

      word-break: break-word;

    }

    .modal-actions{

      margin-top: 14px;

      display:flex;

      justify-content:flex-end;

      gap: 10px;

      flex-wrap: wrap;

    }

 

    /* ====== RESPONSIVE ====== */

    @media (max-width: 900px){

      .bias-grid{ grid-template-columns: 1fr; }

      .status-strip{ justify-content: center; }

      .status-actions{ justify-content: center; }

      .os-meta{ justify-content: center; }

      .chips{ justify-content: flex-start; }

    }

 

    /* ====== MOBILE MODE (AUTO or FORCED) ====== */

    body.mobile .container{

      max-width: 100%;

      padding: 18px 12px 90px;

    }

    body.mobile .logo{ height: 68px; }

    body.mobile .subtitle{ letter-spacing: 3px; }

    body.mobile .card{ padding: 16px; }

    body.mobile .card h2{ font-size: 1.35rem; }

    body.mobile textarea{

      font-size: 1.05rem;

      min-height: 140px;

    }

    body.mobile .mode-btn{

      padding: 11px 16px;

      font-size: 0.95rem;

    }

    body.mobile .toolbar{

      position: sticky;

      bottom: 10px;

      background: rgba(0,0,0,0.35);

      backdrop-filter: blur(16px);

      border: 1px solid var(--border);

      border-radius: 14px;

      padding: 12px;

      z-index: 40;

      box-shadow: var(--shadow-soft);

    }

    body.mobile .toolbar-left{ width: 100%; justify-content: space-between; }

    body.mobile .toolbar-right{ width: 100%; justify-content: stretch; }

    body.mobile .btn-primary{ width: 100%; }

 

    @media (max-width: 560px){

      .modal-grid{ grid-template-columns: 1fr; }

    }

 

    @media (prefers-reduced-motion: reduce){

      #bgCanvas{ display:none; }

    }

  </style>

</head>

 

<body>

  <canvas id="bgCanvas" aria-hidden="true"></canvas>

 

  <div class="container">

    <header>

      <img src="/static/zotheos_logo.png" alt="ZOTHEOS" class="logo" />

      <div class="subtitle">OFFLINE ETHICAL INTELLIGENCE | DIGITAL GUARDIAN</div>

      <div class="promise">FUSION CLARITY | FULL TRANSPARENCY</div>

    </header>

 

    <!-- Beginner-friendly status strip -->

    <div class="status-strip">

      <div class="os-meta">

        <span class="pill"><span class="dot" id="wsDot"></span> <span id="wsStatus">DISCONNECTED</span></span>

        <span class="pill">CORES: <span id="coresCount">—</span></span>

        <span class="pill">EVIDENCE: <span id="evidenceStatus">OFF</span></span>

        <span class="pill">OFFLINE: <span id="offlineStatus">ON</span></span>

        <span class="pill">VIEW: <span id="viewStatus">AUTO</span></span>

      </div>

 

      <div class="status-actions">

        <button class="btn-quiet" id="modelsBtn" onclick="openModelPicker()">MODELS</button>

        <button class="btn-quiet" id="mobileCycleBtn" onclick="cycleMobileMode()" title="Switch between AUTO / ON / OFF">MOBILE: <span id="mobileModeLabel">AUTO</span></button>

        <button class="btn-quiet" id="advancedToggleBtn" onclick="toggleAdvanced()" aria-expanded="false">ADVANCED ▾</button>

      </div>

    </div>

 

    <!-- Advanced drawer -->

    <div class="card slim" id="advancedPanel" style="display:none;">

      <div class="row">

        <div class="mini muted">Power tools, session controls, and debugging.</div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">

          <button class="btn-quiet" onclick="copySynthesis()" title="Copy synthesis to clipboard">COPY ANSWER</button>

          <button class="btn-quiet" onclick="exportLastJSON()" title="Download last response JSON">EXPORT JSON</button>

          <button class="btn-quiet btn-danger" onclick="hardResetSession()" title="Reset local session state">RESET SESSION</button>

        </div>

      </div>

 

      <div class="row" style="margin-top:12px;">

        <div class="os-meta">

          <span class="pill">SYSTEM: <span id="sysVersion">SOVEREIGN-v3.2</span></span>

          <span class="pill"><span id="clock">00:00:00 UTC</span></span>

          <span class="pill">UPTIME: <span id="uptime">0h 0m 0s</span></span>

          <span class="pill">SESSION_ID: <span id="threadId" style="color:var(--ok)">—</span></span>

        </div>

      </div>

 

      <div class="row" style="margin-top:14px;">

        <div class="mini muted" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">

          <span class="chip">THREAD: <b id="threadState">—</b></span>

          <span class="chip">PARENT: <b id="parentThread">—</b></span>

          <span class="chip">STATE: <b id="threadMode">hot</b></span>

        </div>

 

        <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">

          <button class="btn-quiet" onclick="threadFork()">FORK</button>

          <button class="btn-quiet" onclick="threadMerge()">MERGE</button>

        </div>

      </div>

 

      <details class="section" style="margin-top:14px;">

        <summary>RAW PAYLOAD (DEBUG)</summary>

        <pre id="rawPayload" style="margin-top:12px; font-family:var(--mono); font-size:0.72rem; color:#bdbdbd; white-space:pre-wrap; word-break:break-word;"></pre>

      </details>

    </div>

 

    <!-- Modes -->

    <div class="mode-switch">

      <button class="mode-btn active" id="btnFusion" onclick="setMode('fusion')">ANSWER</button>

      <button class="mode-btn" id="btnArchitect" onclick="setMode('architect')">PLAN</button>

      <button class="mode-btn" id="btnEvolution" onclick="setMode('evolution')">STATUS</button>

    </div>

 

    <!-- Fusion panel -->

    <div id="panelFusion" class="panel active">

 

      <div class="card">

        <h2>Conversation</h2>

        <div class="row">

          <div class="mini muted">Start fresh or continue your current session.</div>

          <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">

            <button class="btn-quiet" onclick="location.reload()">NEW CHAT</button>

            <button class="btn-quiet" id="continueBtn" onclick="threadContinue()">CONTINUE</button>

          </div>

        </div>

 

        <div class="hintbar">

          <span><span class="kbd">Ctrl</span> + <span class="kbd">Enter</span> = Ask</span>

          <span>•</span>

          <span><span class="kbd">Ctrl</span> + <span class="kbd">K</span> = Focus</span>

          <span>•</span>

          <span><span class="kbd">Esc</span> = Stop Loader</span>

        </div>

      </div>

 

      <div class="input-box">

        <div class="guide-row">

          <div class="guide-left">

            <div class="guide-title">Ask anything</div>

            <div class="guide-sub">Type a question. Toggle evidence if you want ZOTHEOS to use your local vault.</div>

          </div>

 

          <div class="chips" aria-label="Example prompts">

            <button class="chip-btn" onclick="setExample('Explain this like I’m new: ')">Explain simply</button>

            <button class="chip-btn" onclick="setExample('Compare these two options: ')">Compare</button>

            <button class="chip-btn" onclick="setExample('Help me write a message about: ')">Write a message</button>

            <button class="chip-btn" onclick="setExample('Summarize this topic with pros/cons: ')">Summarize</button>

          </div>

        </div>

 

        <textarea id="queryInput" placeholder="Type your question here..."></textarea>

 

        <div class="toolbar">

          <div class="toolbar-left">

            <div class="toggle" id="researchToggle" onclick="toggleResearch()" title="Use your local Knowledge Vault evidence">

              <div class="switch"></div>

              <span id="researchLabel">USE MY FILES (EVIDENCE): OFF</span>

            </div>

 

            <span class="tip">

              <button type="button" onclick="showEvidenceHelp()" title="What does Evidence do?">?</button>

              <span class="muted">What is Evidence?</span>

            </span>

 

            <button class="btn-quiet" onclick="clearQuery()">CLEAR</button>

          </div>

 

          <div class="toolbar-right">

            <button class="btn-primary" onclick="igniteFusion()">ASK ZOTHEOS</button>

          </div>

        </div>

      </div>

 

      <div id="loader" class="loader">/// THINKING ///</div>

 

      <div id="output">

        <div class="card">

          <div class="row" style="align-items:flex-start;">

            <div style="flex:1 1 auto; min-width:0;">

              <h2>Answer</h2>

            </div>

            <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">

              <span class="chip" id="modelsChip">CORES: —</span>

              <span class="chip" id="runtimeChip">RUNTIME: —</span>

            </div>

          </div>

 

          <div id="synthesis" class="synthesis"></div>

          <div class="runtime" id="runtimeDisplay"></div>

 

          <details class="section" id="vaultSection" style="display:none;">

            <summary>SOURCES USED (EVIDENCE)</summary>

            <div id="vaultCard" style="display:block; margin-top:12px;">

              <div id="vaultList"></div>

            </div>

          </details>

 

          <details class="section">

            <summary>OTHER PERSPECTIVES</summary>

            <div id="perspectivesGrid" class="perspectives-grid" style="margin-top:12px;"></div>

          </details>

 

          <details class="section">

            <summary>WHY THIS ANSWER (ARBITRATION + DIAGNOSTICS)</summary>

 

            <div class="card slim" id="arbitrationCard" style="margin-top:12px;">

              <div id="dissonanceAlert" class="alert">

                ⚠️ <strong>ETHICAL DISSONANCE:</strong> Conflict detected between internal model cores.

              </div>

              <div id="arbitrationSummary" class="arb-summary">—</div>

            </div>

 

            <div class="card slim" style="margin-top:12px;">

              <div class="bias-grid">

                <div>

                  <label class="mini muted" style="letter-spacing:1px;">BIAS LEVEL</label>

                  <div class="bias-bar-outer"><div id="barBias" class="bias-bar-inner"></div></div>

                  <div class="diag-stat"><span>Bias Score</span><b id="biasNum">0/100</b></div>

 

                  <label class="mini muted" style="margin-top:14px; display:block; letter-spacing:1px;">TRUST LEVEL (RELIABILITY)</label>

                  <div class="bias-bar-outer"><div id="barRel" class="bias-bar-inner" style="background:rgba(255,255,255,0.9)"></div></div>

                  <div class="diag-stat"><span>Reliability</span><b id="relNum">0/100</b></div>

 

                  <label class="mini muted" style="margin-top:14px; display:block; letter-spacing:1px;">EMOTIONAL CHARGE</label>

                  <div class="bias-bar-outer"><div id="barEmo" class="bias-bar-inner" style="background:rgba(255,59,59,0.85)"></div></div>

                  <div class="diag-stat"><span>Emotional Charge</span><b id="emoNum">0/100</b></div>

 

                  <div class="diag-stat" style="margin-top:14px;">

                    <span>Reliability Spread</span>

                    <b id="spreadNum">—</b>

                  </div>

                </div>

 

                <div style="border-left: 1px solid var(--border); padding-left: 22px;">

                  <div id="leaning" class="leaning">NEUTRAL</div>

 

                  <details>

                    <summary>LOGIC TRACE</summary>

                    <ul id="logicTraceList" style="margin-top:12px; font-family:var(--mono); font-size:0.72rem; color:var(--text-dim); list-style:none; padding:0;"></ul>

                  </details>

                </div>

              </div>

            </div>

 

          </details>

        </div>

      </div>

    </div>

 

    <!-- Architect panel -->

    <div id="panelArchitect" class="panel">

      <div class="card">

        <h2>Plan</h2>

        <p class="muted" style="font-size:0.92rem; margin-top:0;">

          Turn a goal into a step-by-step plan.

        </p>

 

        <textarea id="archInput" placeholder="Example: Build a 7-day launch plan for ZOTHEOS."></textarea>

 

        <div class="toolbar" style="margin-top:12px;">

          <div class="toolbar-left">

            <span class="mini muted">Planning mode uses a separate pipeline.</span>

          </div>

          <div class="toolbar-right">

            <button class="btn-primary" onclick="runArch()">GENERATE PLAN</button>

          </div>

        </div>

 

        <div class="card slim" style="margin-top:18px;">

          <h2 style="margin-top:0;">Output</h2>

          <pre id="archOutput" style="margin:0; font-family:var(--mono); font-size:0.82rem; color:#cfcfcf; white-space:pre-wrap; word-break:break-word;">—</pre>

        </div>

      </div>

    </div>

 

    <!-- Evolution panel -->

    <div id="panelEvolution" class="panel">

      <div class="card">

        <h2>Status</h2>

        <p class="muted" style="font-size:0.92rem; margin-top:0;">

          Sync the local vault and verify system health.

        </p>

 

        <div class="toolbar" style="border-top:none; padding-top:0; margin-top:12px;">

          <div class="toolbar-left">

            <button class="btn-primary" onclick="syncLibrary()">SYNC EVIDENCE VAULT</button>

            <button class="btn-quiet" onclick="runDiag()">RUN DIAGNOSTIC</button>

          </div>

          <div class="toolbar-right">

            <span class="mini muted">If sync fails, verify /vault/sync route.</span>

          </div>

        </div>

 

        <div class="card slim" style="margin-top:18px;">

          <h2 style="margin-top:0;">Log</h2>

          <div id="diagLog" style="font-family:var(--mono); font-size:0.82rem; color:rgba(255,255,255,0.9); line-height: 1.6;">

            &gt; System State: Standing By...

          </div>

        </div>

      </div>

    </div>

 

  </div>

 

  <div class="toasts" id="toasts"></div>

 

  <!-- MODEL MODAL -->

  <div class="modal-backdrop" id="modelModalBackdrop" role="dialog" aria-modal="true" aria-hidden="true">

    <div class="modal">

      <div class="modal-head">

        <div>

          <h3 class="modal-title" id="modelModalTitle">MODEL</h3>

          <p class="modal-sub" id="modelModalSub">—</p>

        </div>

        <button class="btn-quiet" onclick="closeModelModal()">CLOSE</button>

      </div>

 

      <div class="modal-grid" id="modelModalGrid"></div>

 

      <div class="modal-actions">

        <button class="btn-quiet" onclick="copyModelCard()">COPY CARD</button>

        <button class="btn-primary" onclick="closeModelModal()">DONE</button>

      </div>

    </div>

  </div>

 

  <script>

    // ---------- BACKGROUND: OCEAN + NEBULA HYBRID ----------

    (function initLivingBackground(){

      const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      if (reduceMotion) return;

 

      const canvas = document.getElementById("bgCanvas");

      if (!canvas) return;

      const ctx = canvas.getContext("2d", { alpha: true, desynchronized: true });

      if (!ctx) return;

 

      let w = 0, h = 0, dpr = 1;

 

      const noiseTile = document.createElement("canvas");

      const nt = noiseTile.getContext("2d");

      noiseTile.width = 256;

      noiseTile.height = 256;

 

      function seedNoise(){

        const img = nt.createImageData(noiseTile.width, noiseTile.height);

        for (let i = 0; i < img.data.length; i += 4) {

          const v = (Math.random() * 255) | 0;

          img.data[i] = v; img.data[i+1] = v; img.data[i+2] = v;

          img.data[i+3] = 34;

        }

        nt.putImageData(img, 0, 0);

      }

      seedNoise();

 

      function resize(){

        dpr = Math.min(2, window.devicePixelRatio || 1);

        w = Math.floor(window.innerWidth * dpr);

        h = Math.floor(window.innerHeight * dpr);

        canvas.width = w;

        canvas.height = h;

      }

      window.addEventListener("resize", resize, { passive: true });

      resize();

 

      function bloom(x, y, r, rgbaA, rgbaB){

        const g = ctx.createRadialGradient(x, y, 0, x, y, r);

        g.addColorStop(0, rgbaA);

        g.addColorStop(1, rgbaB);

        return g;

      }

 

      function drawCaustics(t){

        ctx.save();

        ctx.globalCompositeOperation = "screen";

        ctx.lineWidth = 1.0 * dpr;

        ctx.globalAlpha = 0.16;

 

        const bands = 14;

        for (let b = 0; b < bands; b++){

          const yBase = (h * (0.35 + b * 0.045)) + Math.sin(t*0.7 + b) * (16*dpr);

          ctx.beginPath();

 

          const amp = (18 + b*1.2) * dpr;

          const freq = 0.006 + b*0.00018;

          const phase = t*0.9 + b*1.7;

 

          for (let x = 0; x <= w; x += 10*dpr){

            const y = yBase

              + Math.sin(x*freq + phase) * amp

              + Math.sin(x*(freq*1.9) - phase*0.8) * (amp*0.35);

            ctx.lineTo(x, y);

          }

 

          const redPulse = 0.35 + 0.35*Math.sin(t*0.6 + b);

          ctx.strokeStyle = `rgba(255, ${Math.floor(255 - 140*redPulse)}, ${Math.floor(255 - 140*redPulse)}, 0.22)`;

          ctx.stroke();

        }

 

        ctx.restore();

      }

 

      function drawNebula(t){

        ctx.save();

        ctx.globalCompositeOperation = "lighter";

        ctx.globalAlpha = 0.95;

 

        const x1 = w*0.22 + Math.sin(t*0.18)*140*dpr;

        const y1 = h*0.22 + Math.cos(t*0.12)*120*dpr;

 

        const x2 = w*0.78 + Math.cos(t*0.15)*160*dpr;

        const y2 = h*0.30 + Math.sin(t*0.11)*130*dpr;

 

        const x3 = w*0.50 + Math.sin(t*0.10)*110*dpr;

        const y3 = h*0.82 + Math.cos(t*0.09)*140*dpr;

 

        ctx.fillStyle = "rgba(0,0,0,0.18)";

        ctx.fillRect(0,0,w,h);

 

        ctx.fillStyle = bloom(x3, y3, Math.max(w,h)*0.55, "rgba(255,255,255,0.08)", "rgba(0,0,0,0)");

        ctx.fillRect(0,0,w,h);

 

        ctx.fillStyle = bloom(x1, y1, Math.max(w,h)*0.55, "rgba(255,59,59,0.09)", "rgba(0,0,0,0)");

        ctx.fillRect(0,0,w,h);

 

        ctx.fillStyle = bloom(x2, y2, Math.max(w,h)*0.62, "rgba(255,59,59,0.07)", "rgba(0,0,0,0)");

        ctx.fillRect(0,0,w,h);

 

        ctx.restore();

      }

 

      function drawNoise(t){

        ctx.save();

        ctx.globalCompositeOperation = "overlay";

        ctx.globalAlpha = 0.10;

 

        const ox = (Math.sin(t*0.12) * 80 + 120) * dpr;

        const oy = (Math.cos(t*0.10) * 70 + 100) * dpr;

 

        for (let y = -oy; y < h + 256*dpr; y += 256*dpr){

          for (let x = -ox; x < w + 256*dpr; x += 256*dpr){

            ctx.drawImage(noiseTile, x, y, 256*dpr, 256*dpr);

          }

        }

 

        ctx.globalCompositeOperation = "soft-light";

        ctx.globalAlpha = 0.07;

        ctx.fillStyle = "rgba(255,59,59,1)";

        ctx.fillRect(0,0,w,h);

 

        ctx.restore();

      }

 

      let last = 0;

      const targetFrameMS = 1000/45;

 

      function loop(ts){

        if (!last) last = ts;

        const dt = ts - last;

        if (dt >= targetFrameMS){

          last = ts;

          const t = ts * 0.001;

 

          ctx.clearRect(0,0,w,h);

          const bg = ctx.createLinearGradient(0,0,w,h);

          bg.addColorStop(0, "rgba(0,0,0,1)");

          bg.addColorStop(0.55, "rgba(10,10,12,1)");

          bg.addColorStop(1, "rgba(0,0,0,1)");

          ctx.fillStyle = bg;

          ctx.fillRect(0,0,w,h);

 

          drawNebula(t);

          drawCaustics(t);

          drawNoise(t);

        }

        requestAnimationFrame(loop);

      }

 

      requestAnimationFrame(loop);

      setInterval(() => seedNoise(), 12000);

    })();

 

    /* ============================

      ZOTHEOS OS — CLIENT LOGIC

    ============================ */

 

    // ---------- MODEL REGISTRY ----------

    const MODEL_REGISTRY = [

      {

        key: "mistral",

        displayName: "MISTRAL",

        fullName: "Mistral (GGUF Local Build)",

        provider: "Mistral AI",

        roleHint: "Core role varies by mode (you can map it).",

        strengths: "Nuance, summarization, balanced writing, instruction following.",

        notes: "Runs locally via llama.cpp stack. Quantization impacts speed/quality."

      },

      {

        key: "gemma",

        displayName: "GEMMA",

        fullName: "Gemma (GGUF Local Build)",

        provider: "Google / DeepMind",

        roleHint: "Core role varies by mode (you can map it).",

        strengths: "Efficiency, reasoning, structured outputs.",

        notes: "Great as a reliability anchor when fused."

      },

      {

        key: "qwen",

        displayName: "QWEN",

        fullName: "Qwen (GGUF Local Build)",

        provider: "Alibaba / Qwen Team",

        roleHint: "Core role varies by mode (you can map it).",

        strengths: "Multilingual, strong general reasoning, creative breadth.",

        notes: "Often strong in counterpoints and alternative interpretations."

      }

    ];

 

    const MODEL_KEYWORDS = [

      { match: /mistral/i, key: "mistral" },

      { match: /gemma/i, key: "gemma" },

      { match: /qwen/i, key: "qwen" }

    ];

 

    function mapModelName(raw){

      const s = (raw || "").toString();

      for (const k of MODEL_KEYWORDS){

        if (k.match.test(s)) {

          const m = MODEL_REGISTRY.find(x => x.key === k.key);

          return m ? m.displayName : s;

        }

      }

      return s;

    }

 

    // ---------- MOBILE MODE (AUTO / ON / OFF) ----------

    const MOBILE_KEY = "zotheos_mobile_mode"; // auto|on|off

    let mobileMode = (localStorage.getItem(MOBILE_KEY) || "auto").toLowerCase();

 

    function isAutoMobile(){

      return window.matchMedia && window.matchMedia("(max-width: 900px)").matches;

    }

 

    function applyMobileClass(){

      const shouldMobile =

        mobileMode === "on" ? true :

        mobileMode === "off" ? false :

        isAutoMobile();

 

      document.body.classList.toggle("mobile", shouldMobile);

 

      const view = document.getElementById("viewStatus");

      const label = document.getElementById("mobileModeLabel");

      if (view) view.textContent = (mobileMode === "auto" ? (shouldMobile ? "MOBILE" : "DESKTOP") : (mobileMode === "on" ? "MOBILE" : "DESKTOP"));

      if (label) label.textContent = mobileMode.toUpperCase();

    }

 

    function cycleMobileMode(){

      mobileMode = mobileMode === "auto" ? "on" : (mobileMode === "on" ? "off" : "auto");

      localStorage.setItem(MOBILE_KEY, mobileMode);

      applyMobileClass();

      toast("ok", "View Mode", `Mobile mode set to ${mobileMode.toUpperCase()}.`);

    }

 

    window.addEventListener("resize", () => {

      if (mobileMode === "auto") applyMobileClass();

    }, { passive: true });

 

    // ---------- STATE ----------

    let researchActive = false;

    let currentId = null;

    let startTime = Date.now();

    let lastPayload = null;

 

    let threadMeta = {

      thread: null,

      parent: null,

      state: "hot"

    };

 

    const $ = (id) => document.getElementById(id);

 

    function setText(id, text) {

      const el = $(id);

      if (el) el.textContent = text;

    }

 

    function escapeHTML(str) {

      return (str || "")

        .replaceAll("&", "&amp;")

        .replaceAll("<", "&lt;")

        .replaceAll(">", "&gt;")

        .replaceAll("\"", "&quot;")

        .replaceAll("'", "&#039;");

    }

 

    function toSafeHTMLWithBreaks(text) {

      return escapeHTML(text).replace(/\n/g, "<br>");

    }

 

    function toast(type, title, msg, ttl=4500) {

      const box = $("toasts");

      if (!box) return;

 

      const el = document.createElement("div");

      el.className = `toast ${type || ""}`;

 

      el.innerHTML = `

        <div class="ticon"></div>

        <div class="tmain">

          <div class="ttitle">${escapeHTML(title || "NOTICE")}</div>

          <p class="tmsg">${escapeHTML(msg || "")}</p>

        </div>

        <button class="tclose" aria-label="Close">X</button>

      `;

 

      el.querySelector(".tclose").addEventListener("click", () => el.remove());

      box.appendChild(el);

 

      if (ttl > 0) setTimeout(() => el.remove(), ttl);

    }

 

    // Advanced drawer

    function toggleAdvanced(){

      const p = $("advancedPanel");

      const b = $("advancedToggleBtn");

      if (!p || !b) return;

      const open = p.style.display !== "none";

      p.style.display = open ? "none" : "block";

      b.setAttribute("aria-expanded", open ? "false" : "true");

      b.textContent = open ? "ADVANCED ▾" : "ADVANCED ▴";

    }

 

    // Example chips

    function setExample(text){

      const input = $("queryInput");

      if (!input) return;

      if (!input.value.trim()) input.value = text;

      else input.value = text + input.value;

      input.focus();

      input.setSelectionRange(input.value.length, input.value.length);

    }

 

    function showEvidenceHelp(){

      toast("ok", "Evidence", "When ON, ZOTHEOS searches your local Knowledge Vault and injects relevant snippets into the answer (shown under Sources Used).", 6000);

    }

 

    setInterval(() => {

      const now = new Date();

      setText("clock", now.toUTCString().split(" ")[4] + " UTC");

 

      const uptime = Math.floor((Date.now() - startTime) / 1000);

      const mins = Math.floor(uptime / 60);

      const hrs = Math.floor(mins / 60);

      setText("uptime", `${hrs}h ${mins % 60}m ${uptime % 60}s`);

    }, 1000);

 

    function setMode(mode) {

      $("panelFusion").classList.remove("active");

      $("panelArchitect").classList.remove("active");

      $("panelEvolution").classList.remove("active");

      $("btnFusion").classList.remove("active");

      $("btnArchitect").classList.remove("active");

      $("btnEvolution").classList.remove("active");

 

      if (mode === "fusion") {

        $("panelFusion").classList.add("active");

        $("btnFusion").classList.add("active");

      } else if (mode === "architect") {

        $("panelArchitect").classList.add("active");

        $("btnArchitect").classList.add("active");

      } else if (mode === "evolution") {

        $("panelEvolution").classList.add("active");

        $("btnEvolution").classList.add("active");

      }

 

      if (mode === "fusion") $("queryInput")?.focus();

    }

 

    function toggleResearch() {

      researchActive = !researchActive;

      const t = $("researchToggle");

      const label = $("researchLabel");

 

      if (researchActive) {

        t.classList.add("on");

        label.textContent = "USE MY FILES (EVIDENCE): ON";

        setText("evidenceStatus", "ON");

        toast("ok", "Evidence", "Evidence injection enabled.");

      } else {

        t.classList.remove("on");

        label.textContent = "USE MY FILES (EVIDENCE): OFF";

        setText("evidenceStatus", "OFF");

        toast("warn", "Evidence", "Evidence injection disabled.");

      }

    }

 

    function clearQuery(){

      $("queryInput").value = "";

      $("queryInput").focus();

      toast("ok", "Cleared", "Input cleared.");

    }

 

    function hardResetSession(){

      currentId = null;

      lastPayload = null;

      threadMeta = { thread: null, parent: null, state: "hot" };

 

      setText("threadId", "—");

      setText("threadState", "—");

      setText("parentThread", "—");

      setText("threadMode", "hot");

      const cbtn = $("continueBtn");

      if (cbtn) cbtn.disabled = false;

 

      $("output").style.display = "none";

      $("loader").style.display = "none";

 

      toast("warn", "Session Reset", "Local session state reset.");

    }

 

    async function copySynthesis(){

      const syn = $("synthesis")?.textContent || "";

      if (!syn.trim()){

        toast("warn", "Copy", "No answer to copy yet.");

        return;

      }

      try{

        await navigator.clipboard.writeText(syn);

        toast("ok", "Copied", "Answer copied.");

      } catch(e){

        toast("bad", "Copy Failed", "Clipboard permission blocked.");

      }

    }

 

    function exportLastJSON(){

      if (!lastPayload){

        toast("warn", "Export", "No payload available yet.");

        return;

      }

      try{

        const blob = new Blob([JSON.stringify(lastPayload, null, 2)], { type: "application/json" });

        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");

        a.href = url;

        a.download = `zotheos_payload_${Date.now()}.json`;

        document.body.appendChild(a);

        a.click();

        a.remove();

        URL.revokeObjectURL(url);

        toast("ok", "Exported", "Downloaded last payload JSON.");

      } catch(e){

        toast("bad", "Export Failed", "Could not export payload.");

      }

    }

 

    function threadFork() { toast("ok", "Thread", "Fork requested (UI placeholder)."); alert("Session forked to new branch."); }

    function threadContinue(){ toast("ok", "Thread", "Continue requested."); $("queryInput").focus(); }

    function threadMerge(){ toast("warn", "Thread", "Merge not enabled in this build."); alert("Merge is currently disabled."); }

 

    async function syncLibrary() {

      const log = $("diagLog");

      log.innerHTML = "&gt; ACCESSING LIBRARIAN...<br>&gt; SCANNING VAULT_RAW DIRECTORY...";

 

      try {

        const res = await fetch("/vault/sync", { method: "POST" });

        const data = await res.json();

 

        if (data.status === "success") {

          log.innerHTML =

            `&gt; SUCCESS: KNOWLEDGE INDEX UPDATED.<br>` +

            `&gt; NEW FILES: ${escapeHTML(String(data.stats?.new ?? "0"))}<br>` +

            `&gt; TOTAL CHUNKS: ${escapeHTML(String(data.stats?.total ?? "0"))}<br>` +

            `&gt; STATE: READY`;

 

          toast("ok", "Vault Sync", "Evidence vault updated.");

        } else {

          log.innerHTML = "&gt; ERROR: Vault sync returned non-success status.";

          toast("bad", "Vault Sync Failed", "Non-success response from server.");

        }

      } catch (e) {

        log.innerHTML = "&gt; ERROR: CONNECTION INTERRUPTED.";

        toast("bad", "Vault Sync Failed", "Server route /vault/sync not reachable.");

      }

    }

 

    function runDiag() {

      const log = $("diagLog");

      log.innerHTML =

        "&gt; DIAGNOSTIC RUNNING...<br>" +

        "&gt; CHECKING MODEL HEALTH...<br>" +

        "&gt; PINGING SENTINEL LAYER...<br>" +

        "&gt; VALIDATING SOCKET CHANNEL...";

 

      setTimeout(() => {

        log.innerHTML += "<br>&gt; ALL SYSTEMS NOMINAL.";

        toast("ok", "Diagnostics", "Basic diagnostics completed.");

      }, 1200);

    }

 

    function runArch() {

      const q = $("archInput").value.trim();

      if (!q) {

        toast("warn", "Plan", "Enter a goal first.");

        return;

      }

      $("archOutput").textContent = "> GENERATING...";

      sendWS({ query: q, mode: "architect" });

    }

 

    function igniteFusion() {

      const q = $("queryInput").value.trim();

      if (!q) {

        toast("warn", "Ask", "Type a question first.");

        return;

      }

 

      $("loader").style.display = "block";

      $("output").style.display = "none";

 

      sendWS({

        query: q,

        mode: "fusion",

        request_research: researchActive,

        conversation_id: currentId

      });

    }

 

    document.addEventListener("keydown", (e) => {

      if (e.ctrlKey && e.key === "Enter") { e.preventDefault(); igniteFusion(); }

      if (e.ctrlKey && (e.key === "k" || e.key === "K")) { e.preventDefault(); $("queryInput").focus(); }

      if (e.key === "Escape") { $("loader").style.display = "none"; }

    });

 

    let ws = null;

    let wsRetries = 0;

    const wsMaxRetries = 999;

    const wsBaseDelay = 500;

 

    function wsUrl() {

      const isHttps = window.location.protocol === "https:";

      const proto = isHttps ? "wss" : "ws";

      return `${proto}://${window.location.host}/ws/fusion`;

    }

 

    function setWsStatus(state) {

      const dot = $("wsDot");

      const label = $("wsStatus");

      if (!dot || !label) return;

 

      if (state === "connected") { dot.className = "dot ok"; label.textContent = "CONNECTED"; }

      else if (state === "connecting") { dot.className = "dot warn"; label.textContent = "CONNECTING"; }

      else { dot.className = "dot bad"; label.textContent = "DISCONNECTED"; }

    }

 

    function connectWS() {

      setWsStatus("connecting");

 

      try {

        ws = new WebSocket(wsUrl());

 

        ws.onopen = () => {

          wsRetries = 0;

          setWsStatus("connected");

          toast("ok", "Connected", "WebSocket connected.");

        };

 

        ws.onclose = () => {

          setWsStatus("disconnected");

          if (wsRetries < wsMaxRetries) {

            wsRetries++;

            const delay = Math.min(8000, wsBaseDelay * Math.pow(1.35, wsRetries));

            toast("warn", "Disconnected", `Reconnecting in ${Math.round(delay)}ms...`, 2200);

            setTimeout(connectWS, delay);

          } else {

            toast("bad", "WebSocket", "Max reconnect attempts reached.");

          }

        };

 

        ws.onerror = () => { setWsStatus("disconnected"); };

 

        ws.onmessage = (event) => {

          let data = null;

          try { data = JSON.parse(event.data); }

          catch (e) { toast("bad", "Parse Error", "Non-JSON message received."); return; }

 

          lastPayload = data;

          const rp = $("rawPayload");

          if (rp) rp.textContent = JSON.stringify(data, null, 2);

 

          if (data.type === "status") return;

 

          if (data.type === "architect_result") {

            $("archOutput").textContent = JSON.stringify(data.plan, null, 2);

            toast("ok", "Plan", "Plan generated.");

            return;

          }

 

          $("loader").style.display = "none";

          $("output").style.display = "block";

 

          const synthesisText = (data.synthesis || "").toString();

          const perspectives = data.perspectives || {};

          const b = data.bias_report || {};

          const arb = data.arbitration || {};

 

          currentId = data.conversation_id || currentId;

          setText("threadId", currentId || "—");

          setText("threadState", currentId ? "active" : "none");

          setText("parentThread", "—");

          setText("threadMode", "hot");

 

          const models = data.models || data.active_models || Object.keys(perspectives || {});

          const modelListRaw = Array.isArray(models) ? models : Object.keys(perspectives || {});

          const modelListDisplay = modelListRaw.map(m => mapModelName(m)).filter(Boolean);

 

          const coreCount = modelListDisplay.length || Object.keys(perspectives || {}).length;

          setText("coresCount", coreCount ? String(coreCount) : "—");

          setText("modelsChip", `CORES: ${modelListDisplay.length ? modelListDisplay.join(", ") : "—"}`);

 

          setText("runtimeChip", `RUNTIME: ${data.runtime || "N/A"}`);

          setText("runtimeDisplay", `[ RUNTIME: ${data.runtime || "N/A"} ]`);

 

          $("synthesis").textContent = synthesisText;

 

          const biasScore = clampNum(b.bias_score, 0, 100);

          const relScore = clampNum(b.reliability_score, 0, 100);

          const emoScore = clampNum(b.emotional_charge, 0, 100);

 

          $("barBias").style.width = biasScore + "%";

          $("barRel").style.width = relScore + "%";

          $("barEmo").style.width = emoScore + "%";

 

          setText("biasNum", `${biasScore}/100`);

          setText("relNum", `${relScore}/100`);

          setText("emoNum", `${emoScore}/100`);

 

          const spread = data.dispersion?.reliability_spread ?? data.reliability_spread ?? "—";

          setText("spreadNum", String(spread));

          setText("leaning", (b.leaning || "NEUTRAL").toString().toUpperCase());

 

          const traceList = $("logicTraceList");

          if (traceList){

            traceList.innerHTML = "";

            (b.logic_trace || []).forEach(t => {

              const li = document.createElement("li");

              li.style.marginBottom = "6px";

              li.style.paddingLeft = "10px";

              li.style.borderLeft = "2px solid rgba(255,255,255,0.08)";

              li.textContent = `• ${t}`;

              traceList.appendChild(li);

            });

          }

 

          const arbitrationText =

            arb.arbitration_summary ||

            arb.summary ||

            (typeof arb === "string" ? arb : "Analysis complete.");

          $("arbitrationSummary").textContent = arbitrationText;

 

          const dissonance = !!data.ethical_dissonance;

          $("dissonanceAlert").style.display = dissonance ? "block" : "none";

          if (dissonance) toast("warn", "Ethical Dissonance", "Conflicting outputs detected.");

 

          renderVault(data);

          renderPerspectives(perspectives);

 

          toast("ok", "Complete", "Answer updated.", 2000);

        };

 

      } catch (e) {

        setWsStatus("disconnected");

        toast("bad", "WebSocket Error", "Failed to initialize WebSocket.");

      }

    }

 

    function sendWS(payload) {

      if (!ws || ws.readyState !== WebSocket.OPEN) {

        toast("bad", "WebSocket", "Not connected.");

        $("loader").style.display = "none";

        return;

      }

      ws.send(JSON.stringify(payload));

    }

 

    function clampNum(v, min, max) {

      const n = Number(v);

      if (Number.isNaN(n)) return min;

      return Math.max(min, Math.min(max, Math.round(n)));

    }

 

    function renderVault(data) {

      const vList = $("vaultList");

      if (!vList) return;

      vList.innerHTML = "";

 

      const hits = data.ranked_chunks || (data.research_bundle ? data.research_bundle.ranked_chunks : []);

      const section = $("vaultSection");

 

      if (hits && hits.length > 0) {

        if (section) section.style.display = "block";

 

        hits.forEach(item => {

          const tier = Number(item.epistemic_tier || 3);

          const tierClass = tier === 1 ? "tier-1" : (tier === 2 ? "tier-2" : "tier-3");

 

          const source = (item.source || "UNKNOWN").toString();

          const sim = (item.similarity_score ?? item.similarity ?? "—");

          const text = (item.text || item.content || "").toString();

 

          const div = document.createElement("div");

          div.className = "vault-item";

 

          div.innerHTML = `

            <div class="vault-head">

              <span class="tier-badge ${tierClass}">TIER_${tier}</span>

              <div class="vault-meta">

                <span class="chip">FILE: ${escapeHTML(source)}</span>

                <span class="chip">SIM: ${escapeHTML(String(sim))}</span>

              </div>

            </div>

            <details>

              <summary>VIEW SNIPPET</summary>

              <div class="vault-body" style="margin-top:10px;">${toSafeHTMLWithBreaks(text.slice(0, 1200))}${text.length > 1200 ? "<br><br><span class='muted'>[truncated]</span>" : ""}</div>

            </details>

          `;

 

          vList.appendChild(div);

        });

      } else {

        if (section) section.style.display = "none";

      }

    }

 

    function renderPerspectives(perspectives) {

      const grid = $("perspectivesGrid");

      if (!grid) return;

 

      grid.innerHTML = "";

      const entries = Object.entries(perspectives || {});

 

      if (entries.length === 0) {

        grid.innerHTML = `<div class="mini muted" style="width:100%;">No additional perspectives returned.</div>`;

        return;

      }

 

      entries.forEach(([core, text]) => {

        const card = document.createElement("div");

        card.className = "persp-card";

 

        const label = mapModelName((core || "CORE").toString().replace('core_', '')).toUpperCase();

        const body = (text || "").toString();

 

        card.innerHTML = `

          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">

            <span class="persp-label">${escapeHTML(label)}</span>

            <div style="display:flex; gap:8px; flex-wrap:wrap;">

              <button class="btn-quiet" style="padding:6px 10px; font-size:0.62rem; min-height:32px;" onclick="openModelModalByLabel('${escapeHTML(label)}')">MODEL CARD</button>

              <button class="btn-quiet" style="padding:6px 10px; font-size:0.62rem; min-height:32px;" data-copy-content>COPY</button>

            </div>

          </div>

          <div class="persp-text">${toSafeHTMLWithBreaks(body)}</div>

        `;

 

        card.querySelector('[data-copy-content]').addEventListener("click", () => {

          navigator.clipboard.writeText(body).then(() => {

            toast("ok", "Copied", `Copied ${label}.`);

          }).catch(() => {

            toast("bad", "Error", "Clipboard denied.");

          });

        });

 

        grid.appendChild(card);

      });

    }

 

    // ---------- MODEL MODAL / PICKER ----------

    let lastModelCardText = "";

 

    function openModelPicker(){

      const list = MODEL_REGISTRY.map(m => m.displayName).join(", ");

      toast("ok", "Models", `Active registry: ${list}. Tap a model in OTHER PERSPECTIVES → MODEL CARD.`, 6500);

      openModelModal(MODEL_REGISTRY[0]);

    }

 

    function openModelModalByLabel(label){

      const clean = (label || "").toString().toLowerCase();

      const m =

        MODEL_REGISTRY.find(x => x.displayName.toLowerCase() === clean) ||

        MODEL_REGISTRY.find(x => clean.includes(x.key));

      if (!m){

        toast("warn", "Model Card", "No model metadata found for this core yet.");

        return;

      }

      openModelModal(m);

    }

 

    function openModelModal(model){

      const back = $("modelModalBackdrop");

      const grid = $("modelModalGrid");

      if (!back || !grid) return;

 

      $("modelModalTitle").textContent = model.displayName || "MODEL";

      $("modelModalSub").textContent = `${model.fullName || "Local GGUF"} • ${model.provider || "Unknown Provider"}`;

 

      const fields = [

        ["Provider", model.provider],

        ["Full Name", model.fullName],

        ["Strengths", model.strengths],

        ["Role Hint", model.roleHint],

        ["Notes", model.notes]

      ];

 

      grid.innerHTML = fields.map(([k,v]) => `

        <div class="kv">

          <div class="k">${escapeHTML(k)}</div>

          <div class="v">${escapeHTML(v || "—")}</div>

        </div>

      `).join("");

 

      lastModelCardText = fields.map(([k,v]) => `${k}: ${v || "—"}`).join("\n");

 

      back.style.display = "flex";

      back.setAttribute("aria-hidden", "false");

    }

 

    function closeModelModal(){

      const back = $("modelModalBackdrop");

      if (!back) return;

      back.style.display = "none";

      back.setAttribute("aria-hidden", "true");

    }

 

    function copyModelCard(){

      if (!lastModelCardText.trim()){

        toast("warn", "Copy", "No model card ready.");

        return;

      }

      navigator.clipboard.writeText(lastModelCardText).then(() => {

        toast("ok", "Copied", "Model card copied.");

      }).catch(() => {

        toast("bad", "Copy Failed", "Clipboard denied.");

      });

    }

 

    document.addEventListener("click", (e) => {

      const back = $("modelModalBackdrop");

      if (!back || back.style.display === "none") return;

      if (e.target === back) closeModelModal();

    });

 

    window.addEventListener("DOMContentLoaded", () => {

      applyMobileClass();

      connectWS();

      const input = $("queryInput");

      if(input) input.focus();

      setText("offlineStatus", "ON");

      setText("evidenceStatus", "OFF");

      setText("mobileModeLabel", mobileMode.toUpperCase());

      console.log("%c ZOTHEOS OS :: ONLINE ", "background:#000; color:#fff; padding:4px; border:1px solid #fff;");

    });

  </script>

</body>

</html>
